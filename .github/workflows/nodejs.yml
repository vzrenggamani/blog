name: Blog Deployment
on:
  push:
    branches: master
jobs:
  BuildDeploy:
    name: Blog Build and Deployment
    runs-on: [ubuntu-18.04]
    env:
     BLOGTOKEN: ${{ secrets.BLOG_TOKEN }}
     ci: true
    steps:
       - name: checkout
         uses: actions/checkout@v2.0.0

       - name: Submodule Checkout
         shell: bash
         run: |
          auth_header="$(git config --local --get http.https://github.com/.extraheader)"
          git submodule sync --recursive
          git -c "http.extraheader=$auth_header" -c protocol.version=2 submodule update --init --force --recursive --depth=1
        
       - name: Install Hugo
         uses: peaceiris/actions-hugo@v2
         with:
          hugo-version: 'latest'

       - name: Install Node
         uses: actions/setup-node@v1
         with:
          node-version: '12.x'

       - name: Install Dependencies
         run: npm install workbox-cli netlify-cli -g
       
       - name: Fire and Launch
         run: hugo --minify && 
              workbox generateSW --watch && 
              netlify deploy --site renggablog --auth $BLOGTOKEN --prod --dir=public
